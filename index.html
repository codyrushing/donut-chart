<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF8">
	<title>Donut Charts</title>
</head>
<style type="text/css">
.slice path {cursor: pointer;}
</style>
<body>

	<div id="container">

	</div>

    <script type="text/javascript" src="js/lib/d3.min.js"></script>
    <script type="text/javascript" src="js/donut-chart.js"></script>
    <script type="text/javascript">
    var labels;

    var aListPointsChart = new app.donutChart({
        container: "#container",
        height: 300,
        width: 300,
        id: "a-list-points-chart",
        label: "Points",
        type: "points",
        origin: -130,
        destination: 130,
        thickness: 25,
        padding: 50,
        useTransition: true,
        remainderLabel: "points needed",
        transitionComplete: function(){
            /*
            * fade in labels on 
            */
            labels.transition().duration(1000).attrTween("opacity", function(){
                var interpolate = d3.interpolate(0, 1);
                return function(t) {
                    return interpolate(t);
                };                                    
            });
        },
        buildComplete: function() {
        	var self = this;

            /* 
            * add arc labels
            */
            labels = this.slices
        		.append("svg:text")
				.attr("transform", function(d, i) {
                    var o = {
                        startAngle: d.startAngle,
                        endAngle: d.endAngle,
                        innerRadius: self.width/2,
                        outerRadius: self.width/2 + 50
                    };
			        return "translate(" + self.baseArc.centroid(o) + ")";
			    })
			    .attr("text-anchor", "middle")
                .attr("opacity", this.useTransition ? 0 : 1)
			    .text(function(d){
					return d.n;
				});

            /* 
            * add global label
            */
            this.dataGroup.append("svg:text")
                .attr("dy", ".35em")
                .attr("text-anchor", "middle")
                .style("font", "bold 36px Arial")
                .text(this.label);

            /* 
            * events example
            */
            this.arcs
            .on("mouseover", function(d, i){
                d.outerRadius = self.baseArc.outerRadius()(d) + 5;
                d.innerRadius = self.baseArc.innerRadius()(d) - 5; 
                d3.select(this).attr("d", self.baseArc(d));
            })
            .on("mouseout", function(d, i){
                d.outerRadius -= 5;
                d.innerRadius += 5;
                d3.select(this).attr("d", self.baseArc(d));
            });

            /*
            * tacking something on to transition
            */
            var remainderLabel = this.dataGroup
                .append("svg:text")
                .attr("text-anchor", "middle")
                .attr("transform", "translate(0,"+self.height/2+")")
                .style("font-weight", "bold")
                .text((this.useTransition ? this.total : this.remainder) + " points remaining");

            this.globalTransition(function(){
                remainderLabel.transition()
                .tween("text", function(){
                    var interpolate = d3.interpolate(self.total, self.remainder);
                    return function(t) {
                        this.textContent = Math.round(interpolate(t)) + " points remaining";
                    };                    
                });
            });

        },
        data: {
            total: 70000,
            values: [{
                n: 40125,
                color: "#6dab42"
            }, {
            	n: 10000,
            	color: "#ff0000"
            }, {
            	n: 5000,
            	color: "#0000ff"
            }, {
            	n: 5000,
            	color: "#ffff00"
            }, {
                n: 3000,
                color: "#f92a39"
            }]
        }
    });

    </script>
</body>
</html>